Using a nonce for Content Security Policy (CSP)
---

If the consuming application wishes to apply a CSP header that is strict then in order to use Glamor, the styles will either need to use the `unsafe-inline` rule or a nonce should be added to the style tags as they are dynamically generated.

To have Glamor add a nonce, the nonce should be assigned to a [Webpack variable](https://webpack.js.org/guides/csp/#examples) called `__webpack_nonce__`.

This must be done before any styles have been generated by Glamor.

As an example, if the server was to render the following:

```HTML
<!-- index.html -->
<html>
  <body>
    <h1>Test application</h1>
    <script>
      window.NONCE = 'base64-1234-abcd'
    </script>
    <script src="path-to-entry-bundle.js"></script>
  </body>
</html>
```

Then somewhere very early on the packed bundle should contain an import to a file such as:

```JavaScript
// setup-nonce.js
__webpack_nonce__ = window.NONCE

// index.js
import React from 'react' // no glamor styles here
import { customUtil } from './custom/code' // no glamor styles here
import './setup-nonce'
import GlamorStyledComponent from './components/GlamorStyledComponent'
```

The resulting style tags will look like:

```html
<style
  type="text/css"
  data-glamor=""
  nonce="base64-1234-abcd">
    .css-icjsl7,[data-css-icjsl7]{color:blue;}
</style>
```

Meaning that the CSP header can look more like

```
default-src 'self'; style-src 'nonce-base64-1234-abcd';
```

rather than:

```
default-src 'self'; style-src 'self' 'unsafe-inline';
```
